# https://github.com/macrozheng/mall/blob/8f57a363c5f05844c3838f65bd7bc30bdcb4e470/document/docker/docker-compose-env.yml
version: '3'
services:
    nginx:
        image: nginx:1.19
        container_name: nginx
        ports:
            - 80:80
        environment:
            TZ: Asia/Shanghai
        volumes:
            - $PWD/conf/nginx/nginx.conf:/etc/nginx/nginx.conf #配置文件挂载
            - $PWD/conf/nginx/conf.d:/etc/nginx/conf.d
            - $PWD/data/nginx/html:/usr/share/nginx/html #静态资源根目录挂载
            - $PWD/log/nginx:/var/log/nginx #日志文件挂载
        restart: unless-stopped
    pgsql:
        image: postgres:13
        container_name: pgsql
        ports:
            - 5432:5432
        environment:
            # POSTGRES_PASSWORD: 123456
            POSTGRES_PASSWORD_FILE: /run/secrets/postgres-passwd
        volumes:
            - $PWD/conf/pgsql/postgresql.conf:/etc/postgresql/postgresql.conf #配置文件挂载
            - $PWD/conf/pgsql/secrets:/run/secrets
            - $PWD/data/pgsql:/var/lib/postgresql/data #数据文件挂载
        restart: unless-stopped
    redis:
        image: redis:6
        container_name: redis-server
        ports:
            - 6379:6379
        command: redis-server /usr/local/etc/redis/redis.conf --appendonly yes
        volumes:
            - $PWD/conf/redis/redis.conf:/usr/local/etc/redis/redis.conf
            - $PWD/data/redis:/data #数据文件挂载
        restart: unless-stopped
    nacos-registry:
        image: nacos/nacos-server:1.4.0
        container_name: nacos-registry
        ports:
            - 8848:8848
        environment:
            - 'MODE=standalone'
        restart: unless-stopped
